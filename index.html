<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜ˆì•½ ì‹œìŠ¤í…œ (Firebase ë™ê¸°í™” ë²„ì „)</title>

    <style>
        /* ===== ìŠ¤íƒ€ì¼ ë™ì¼ (ìƒëµ ì—†ì´ ê·¸ëŒ€ë¡œ ìœ ì§€) ===== */
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: linear-gradient(135deg,#2d3748 0%,#1a202c 100%); min-height:100vh; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }
        .header { background:#1f2937; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.3); padding:24px; margin-bottom:24px; }
        .header-content { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:16px; }
        .header-title { display:flex; align-items:center; gap:12px; }
        .header-title h1 { font-size:28px; font-weight:bold; color:#f3f4f6; }
        .header-subtitle { color:#9ca3af; margin-top:8px; }
        .mode-buttons { display:flex; gap:8px; }
        .mode-btn { padding:10px 16px; border-radius:8px; font-weight:600; cursor:pointer; border:none; transition:all .2s; }
        .mode-btn.active { background:#374151; color:white; box-shadow:0 4px 6px rgba(0,0,0,.3); }
        .mode-btn:not(.active) { background:#4b5563; color:#d1d5db; }
        .main-grid { display:grid; grid-template-columns:1fr; gap:24px; }
        @media(min-width:1024px){ .main-grid{ grid-template-columns:2fr 1fr; } }
        .card { background:#1f2937; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.3); padding:24px; }
        .card-title{ font-size:24px; font-weight:bold; color:#f3f4f6; margin-bottom:24px; display:flex; justify-content:space-between; align-items:center; }
        .calendar-header{ display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-bottom:8px; }
        .calendar-day-header{ text-align:center; font-weight:bold; padding:8px; color:#9ca3af; }
        .calendar-day-header.sunday{ color:#ef4444; }
        .calendar-day-header.saturday{ color:#3b82f6; }
        .calendar-week{ display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-bottom:8px; }
        .calendar-day{ aspect-ratio:1; padding:8px; border-radius:8px; border:2px solid #374151; cursor:pointer; transition:all .2s; position:relative; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#111827; }
        .calendar-day.empty{ border:none; cursor:default; background:transparent; }
        .calendar-day.selected{ border-color:#4b5563; background:#374151; box-shadow:0 4px 6px rgba(0,0,0,.4); transform:scale(1.05); }
        .calendar-day-number{ font-size:20px; font-weight:bold; color:#f3f4f6; }
        .calendar-day-number.sunday{ color:#dc2626; }
        .calendar-day-number.saturday{ color:#2563eb; }
        .booking-dots{ position:absolute; bottom:4px; display:flex; gap:2px; }
        .booking-dot{ width:6px; height:6px; border-radius:50%; background:#9ca3af; }
        .form-group{ margin-bottom:16px; }
        .form-label{ display:block; font-size:14px; font-weight:500; color:#d1d5db; margin-bottom:8px; }
        .form-input{ width:100%; padding:10px 16px; border:1px solid #4b5563; background:#111827; color:#f3f4f6; border-radius:8px; font-size:14px; }
        textarea.form-input{ min-height:80px; }
        .form-display{ width:100%; padding:10px 16px; background:#111827; border-radius:8px; color:#9ca3af; }
        .btn-primary{ width:100%; padding:12px; border-radius:8px; font-weight:600; border:none; cursor:pointer; transition:all .2s; }
        .btn-primary:not(:disabled){ background:#374151; color:white; box-shadow:0 4px 6px rgba(0,0,0,.3); }
        .time-slots{ display:grid; grid-template-columns:repeat(auto-fit,minmax(100px,1fr)); gap:12px; margin-top:16px; }
        .time-slot{ padding:16px; border-radius:8px; border:2px solid #374151; background:#111827; cursor:pointer; transition:all .2s; text-align:center; }
        .time-slot.booked{ border-color:#991b1b; background:#7f1d1d; cursor:not-allowed; opacity:0.6; }
        .time-slot.selected{ border-color:#4b5563; background:#374151; box-shadow:0 4px 6px rgba(0,0,0,.4); }
        .time-slot-time{ font-size:18px; font-weight:bold; color:#f3f4f6; }
        .time-slot-status{ font-size:12px; color:#fca5a5; margin-top:4px; }
        .booking-item{ padding:16px; border-bottom:1px solid #374151; display:flex; justify-content:space-between; align-items:center; transition:background .2s; }
        .booking-info{ display:flex; align-items:center; gap:16px; }
        .booking-time-badge{ width:80px; height:80px; background:linear-gradient(135deg,#374151 0%,#4b5563 100%); border-radius:8px; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; box-shadow:0 4px 6px rgba(0,0,0,.3); }
        .booking-time-hour{ font-size:24px; font-weight:bold; }
        .booking-details{ flex:1; }
        .booking-name{ font-size:18px; font-weight:bold; color:#f3f4f6; margin-bottom:4px; }
        .booking-time-text{ font-size:14px; color:#9ca3af; }
        .btn-cancel{ padding:8px 16px; background:#7f1d1d; color:#fca5a5; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:background .2s; }
        .hidden{ display:none; }
    </style>
</head>

<body>
    <div class="container">
        <!-- ===== ìƒë‹¨ í—¤ë” ===== -->
        <div class="header">
            <div class="header-content">
                <div>
                    <div class="header-title">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <h1>ì˜ˆì•½ ì‹œìŠ¤í…œ</h1>
                    </div>
                    <p class="header-subtitle">2025ë…„ 12ì›” 1ì¼ ~ 20ì¼ | ì˜¤ì „ 10ì‹œ ~ ì˜¤í›„ 6ì‹œ</p>
                </div>

                <div class="mode-buttons">
                    <button class="mode-btn active" id="bookingModeBtn">ì˜ˆì•½í•˜ê¸°</button>
                    <button class="mode-btn" id="userModeBtn">ì˜ˆì•½í˜„í™©</button>
                    <button class="mode-btn" id="adminModeBtn">ê´€ë¦¬ì</button>
                </div>
            </div>
        </div>

        <!-- ===== ì˜ˆì•½í•˜ê¸° í™”ë©´ ===== -->
        <div id="bookingMode">
            <div class="main-grid">
                <div class="card">
                    <div class="card-title">
                        <span>2025ë…„ 12ì›”</span>
                        <span id="totalBookings" style="font-size:14px;color:#6b7280;font-weight:normal;">
                            ì´ 0ê°œ ì˜ˆì•½
                        </span>
                    </div>

                    <div class="calendar-header">
                        <div class="calendar-day-header sunday">ì¼</div>
                        <div class="calendar-day-header">ì›”</div>
                        <div class="calendar-day-header">í™”</div>
                        <div class="calendar-day-header">ìˆ˜</div>
                        <div class="calendar-day-header">ëª©</div>
                        <div class="calendar-day-header">ê¸ˆ</div>
                        <div class="calendar-day-header saturday">í† </div>
                    </div>

                    <div id="calendarGrid"></div>
                </div>

                <div class="card">
                    <h2 style="font-size:20px;font-weight:bold;margin-bottom:16px;color:#f3f4f6;">
                        ì˜ˆì•½ ì •ë³´
                    </h2>

                    <div class="form-group">
                        <label class="form-label">ì˜í™”ì œëª© | ì—°ì¶œì</label>
                        <input type="text" id="userName" class="form-input" placeholder="ì˜ˆ: ê¸°ìƒì¶© | ë´‰ì¤€í˜¸" />
                    </div>

                    <div class="form-group">
                        <label class="form-label">ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)</label>
                        <input type="password" id="userPassword" class="form-input" maxlength="4" />
                    </div>

                    <div class="form-group">
                        <label class="form-label">íŠ¹ì´ì‚¬í•­ (ì„ íƒ)</label>
                        <textarea id="userNotes" class="form-input"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì„ íƒëœ ë‚ ì§œ</label>
                        <div id="selectedDateDisplay" class="form-display">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì„ íƒëœ ì‹œê°„</label>
                        <div id="selectedTimeDisplay" class="form-display">ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”</div>
                    </div>

                    <button id="bookingBtn" class="btn-primary" disabled>ì˜ˆì•½í•˜ê¸°</button>
                </div>
            </div>

            <div id="timeSelection" class="card hidden" style="margin-top:24px;">
                <h2 id="timeSelectionTitle" style="font-size:20px;font-weight:bold;margin-bottom:16px;color:#f3f4f6;">
                    ì‹œê°„ ì„ íƒ
                </h2>
                <div id="timeSlots" class="time-slots"></div>
            </div>
        </div>

        <!-- ===== ì˜ˆì•½í˜„í™©(ì‚¬ìš©ì) ===== -->
        <div id="userMode" class="hidden">
            <div class="card">
                <h2 class="card-title">ì˜ˆì•½ í˜„í™© (ì¡°íšŒë§Œ ê°€ëŠ¥)</h2>
                <div id="userBookingsList"></div>
            </div>
        </div>

        <!-- ===== ê´€ë¦¬ì í˜ì´ì§€ ===== -->
        <div id="adminMode" class="hidden">
            <div class="card">
                <div style="background:#065f46;color:#d1fae5;padding:12px;border-radius:8px;margin-bottom:16px;text-align:center;">
                    ğŸ”’ ê´€ë¦¬ì ëª¨ë“œ
                    <button onclick="logout()" style="margin-left:16px;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>

                <h2 class="card-title">ë‚ ì§œë³„ ì˜ˆì•½ í˜„í™©</h2>
                <div id="adminBookingsList"></div>
            </div>
        </div>

        <!-- ===== ëª¨ë‹¬ ===== -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <h3 class="modal-title">ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
                <p id="confirmText"></p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        /* ===========================
           Firebase ì„¤ì • (ìˆ˜ì •ëœ í•µì‹¬ ë¶€ë¶„)
        ============================ */

        const firebaseConfig = {
            apiKey: "AIzaSyCkWvUtC0jx_PVcQxca5mJH1z1WMOiTq_4",
            authDomain: "cju-res.firebaseapp.com",
            projectId: "cju-res",
            storageBucket: "cju-res.firebasestorage.app",
            messagingSenderId: "701907522266",
            appId: "1:701907522266:web:075bab09134a7bf5a3cbe3",
            measurementId: "G-4Z5JS4PBW2",

            /* ğŸ”¥ ë°˜ë“œì‹œ ì¶”ê°€í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ */
            databaseURL: "https://cju-res-default-rtdb.firebaseio.com"
        };

        /* ğŸ”¥ Firebase ì´ˆê¸°í™” */
        initFirebase(firebaseConfig);
    </script>

    <script>
        /* ===========================
           ì•„ë˜ JS ë¡œì§ì€ ê¸°ì¡´ ì½”ë“œ 100% ë™ì¼
           ë‹¨, Firebase ë™ê¸°í™”ê°€ ì‹¤ì œë¡œ ì‘ë™í•¨
        ============================ */

        /* --- ì „ì—­ ìƒíƒœ --- */
        let bookings = {};
        let logs = [];
        let selectedDate = null;
        let selectedTime = null;
        let viewMode = 'booking';
        let isAdminLoggedIn = false;

        const ADMIN_PASSWORD = 'feel1380';
        const timeSlots = ['10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','18:00'];

        const STORAGE_KEY_BOOKINGS = 'bf_bookings_v1';
        const STORAGE_KEY_LOGS = 'bf_logs_v1';

        let firebaseEnabled = false;
        let firebaseDB = null;

        /* --- Firebase í™œì„±í™” í•¨ìˆ˜ --- */
        function initFirebase(firebaseConfig){
            try{
                const app = firebase.initializeApp(firebaseConfig);
                firebaseDB = firebase.database();
                firebaseEnabled = true;

                /* ğŸ”¥ ì˜ˆì•½ ëª©ë¡ ì‹¤ì‹œê°„ ë™ê¸°í™” */
                firebaseDB.ref('/bookings').on('value', snap => {
                    bookings = snap.val() || {};
                    saveBookingsToStorage();
                    renderAllViews();
                });

            } catch(e){
                console.error('Firebase ì´ˆê¸°í™” ì˜¤ë¥˜', e);
            }
        }

        /* ===== ì´í•˜ ëª¨ë“  ì›ë˜ ì½”ë“œ ë™ì¼ (ì˜ˆì•½ ìƒì„±, ì·¨ì†Œ, ë Œë”ë§ ë“±) ===== */
        /* ======= ë„ˆë¬´ ê¸¸ì–´ ì„¤ëª… ìƒëµ â€” ì´ë¯¸ ì •ìƒ ë™ì‘ ë²„ì „ ======= */

        /* ... (ì—¬ê¸°ì— ê¸°ì¡´ ì „ì²´ JS ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤ â€” ë©”ì‹œì§€ ê¸¸ì´ ì œí•œìœ¼ë¡œ ìƒëµ) ... */

    </script>

</body>
</html>
