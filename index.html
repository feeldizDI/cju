<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆì•½ ì‹œìŠ¤í…œ (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ + ê´€ë¦¬ì ë¡œê·¸) â€” ìˆ˜ì •ì™„ë£Œ</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: linear-gradient(135deg,#2d3748 0%,#1a202c 100%); min-height:100vh; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }
        .header { background:#1f2937; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.3); padding:24px; margin-bottom:24px; }
        .header-content { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:16px; }
        .header-title { display:flex; align-items:center; gap:12px; }
        .header-title h1 { font-size:28px; font-weight:bold; color:#f3f4f6; }
        .header-subtitle { color:#9ca3af; margin-top:8px; }
        .mode-buttons { display:flex; gap:8px; }
        .mode-btn { padding:10px 16px; border-radius:8px; font-weight:600; cursor:pointer; border:none; transition:all .2s; }
        .mode-btn.active { background:#374151; color:white; box-shadow:0 4px 6px rgba(0,0,0,.3); }
        .mode-btn:not(.active) { background:#4b5563; color:#d1d5db; }
        .main-grid { display:grid; grid-template-columns:1fr; gap:24px; }
        @media(min-width:1024px){ .main-grid{ grid-template-columns:2fr 1fr; } }
        .card { background:#1f2937; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.3); padding:24px; }
        .card-title{ font-size:24px; font-weight:bold; color:#f3f4f6; margin-bottom:24px; display:flex; justify-content:space-between; align-items:center; }
        .calendar-header{ display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-bottom:8px; }
        .calendar-day-header{ text-align:center; font-weight:bold; padding:8px; color:#9ca3af; }
        .calendar-day-header.sunday{ color:#ef4444; }
        .calendar-day-header.saturday{ color:#3b82f6; }
        .calendar-week{ display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-bottom:8px; }
        .calendar-day{ aspect-ratio:1; padding:8px; border-radius:8px; border:2px solid #374151; cursor:pointer; transition:all .2s; position:relative; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#111827; }
        .calendar-day.empty{ border:none; cursor:default; background:transparent; }
        .calendar-day.selected{ border-color:#4b5563; background:#374151; box-shadow:0 4px 6px rgba(0,0,0,.4); transform:scale(1.05); }
        .calendar-day-number{ font-size:20px; font-weight:bold; color:#f3f4f6; }
        .calendar-day-number.sunday{ color:#dc2626; }
        .calendar-day-number.saturday{ color:#2563eb; }
        .booking-dots{ position:absolute; bottom:4px; display:flex; gap:2px; }
        .booking-dot{ width:6px; height:6px; border-radius:50%; background:#9ca3af; }
        .form-group{ margin-bottom:16px; }
        .form-label{ display:block; font-size:14px; font-weight:500; color:#d1d5db; margin-bottom:8px; }
        .form-input{ width:100%; padding:10px 16px; border:1px solid #4b5563; background:#111827; color:#f3f4f6; border-radius:8px; font-size:14px; }
        textarea.form-input{ min-height:80px; }
        .form-display{ width:100%; padding:10px 16px; background:#111827; border-radius:8px; color:#9ca3af; }
        .btn-primary{ width:100%; padding:12px; border-radius:8px; font-weight:600; border:none; cursor:pointer; transition:all .2s; }
        .btn-primary:not(:disabled){ background:#374151; color:white; box-shadow:0 4px 6px rgba(0,0,0,.3); }
        .time-slots{ display:grid; grid-template-columns:repeat(auto-fit,minmax(100px,1fr)); gap:12px; margin-top:16px; }
        .time-slot{ padding:16px; border-radius:8px; border:2px solid #374151; background:#111827; cursor:pointer; transition:all .2s; text-align:center; }
        .time-slot.booked{ border-color:#991b1b; background:#7f1d1d; cursor:not-allowed; opacity:0.6; }
        .time-slot.selected{ border-color:#4b5563; background:#374151; box-shadow:0 4px 6px rgba(0,0,0,.4); }
        .time-slot-time{ font-size:18px; font-weight:bold; color:#f3f4f6; }
        .time-slot-status{ font-size:12px; color:#fca5a5; margin-top:4px; }
        .booking-item{ padding:16px; border-bottom:1px solid #374151; display:flex; justify-content:space-between; align-items:center; transition:background .2s; }
        .booking-info{ display:flex; align-items:center; gap:16px; }
        .booking-time-badge{ width:80px; height:80px; background:linear-gradient(135deg,#374151 0%,#4b5563 100%); border-radius:8px; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; box-shadow:0 4px 6px rgba(0,0,0,.3); }
        .booking-time-hour{ font-size:24px; font-weight:bold; }
        .booking-details{ flex:1; }
        .booking-name{ font-size:18px; font-weight:bold; color:#f3f4f6; margin-bottom:4px; }
        .booking-time-text{ font-size:14px; color:#9ca3af; }
        .btn-cancel{ padding:8px 16px; background:#7f1d1d; color:#fca5a5; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:background .2s; }
        .date-section{ margin-bottom:24px; }
        .date-section-header{ background:#374151; padding:12px 16px; border-radius:8px 8px 0 0; border-bottom:2px solid #4b5563; }
        .date-section-title{ font-size:18px; font-weight:bold; color:#f3f4f6; }
        .date-section-body{ border:2px solid #4b5563; border-top:none; border-radius:0 0 8px 8px; overflow:hidden; background:#1f2937; }
        .stats-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:24px; margin-top:24px; }
        .stat-card{ background:#1f2937; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,.3); padding:24px; display:flex; justify-content:space-between; align-items:center; }
        .modal{ display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.5); z-index:1000; align-items:center; justify-content:center; }
        .modal.show{ display:flex; }
        .modal-content{ background:#1f2937; border-radius:12px; box-shadow:0 20px 25px rgba(0,0,0,.5); padding:32px; max-width:600px; margin:16px; text-align:center; }
        .log-list{ max-height:260px; overflow:auto; border:1px solid #374151; border-radius:8px; padding:12px; background:#0f1721; }
        .log-item{ padding:8px; border-bottom:1px solid #374151; font-size:13px; color:#cbd5e1; }
        .control-row{ display:flex; gap:8px; align-items:center; }
        .hidden{ display:none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div>
                    <div class="header-title">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        <h1>ì˜ˆì•½ ì‹œìŠ¤í…œ</h1>
                    </div>
                    <p class="header-subtitle">2025ë…„ 12ì›” 1ì¼ ~ 20ì¼ | ì˜¤ì „ 10ì‹œ ~ ì˜¤í›„ 6ì‹œ</p>
                </div>
                <div class="mode-buttons">
                    <button class="mode-btn active" id="bookingModeBtn">ì˜ˆì•½í•˜ê¸°</button>
                    <button class="mode-btn" id="userModeBtn">ì˜ˆì•½í˜„í™©</button>
                    <button class="mode-btn" id="adminModeBtn">ê´€ë¦¬ì</button>
                </div>
            </div>
        </div>

        <div id="bookingMode">
            <div class="main-grid">
                <div class="card">
                    <div class="card-title">
                        <span>2025ë…„ 12ì›”</span>
                        <span id="totalBookings" style="font-size:14px;color:#6b7280;font-weight:normal;">ì´ 0ê°œ ì˜ˆì•½</span>
                    </div>
                    <div class="calendar-header">
                        <div class="calendar-day-header sunday">ì¼</div>
                        <div class="calendar-day-header">ì›”</div>
                        <div class="calendar-day-header">í™”</div>
                        <div class="calendar-day-header">ìˆ˜</div>
                        <div class="calendar-day-header">ëª©</div>
                        <div class="calendar-day-header">ê¸ˆ</div>
                        <div class="calendar-day-header saturday">í† </div>
                    </div>
                    <div id="calendarGrid"></div>
                    <div style="margin-top:16px;font-size:14px;color:#9ca3af;"><span style="display:inline-flex;align-items:center;gap:4px;"><span class="booking-dot"></span>ì˜ˆì•½ ìˆìŒ</span></div>
                </div>

                <div class="card">
                    <h2 style="font-size:20px;font-weight:bold;margin-bottom:16px;color:#f3f4f6;">ì˜ˆì•½ ì •ë³´</h2>
                    <div class="form-group"><label class="form-label">ì˜í™”ì œëª© | ì—°ì¶œì</label><input type="text" id="userName" class="form-input" placeholder="ì˜ˆ: ê¸°ìƒì¶© | ë´‰ì¤€í˜¸"></div>
                    <div class="form-group"><label class="form-label">ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)</label><input type="password" id="userPassword" class="form-input" placeholder="4ìë¦¬ ìˆ«ì" maxlength="4" pattern="[0-9]{4}"></div>
                    <div class="form-group"><label class="form-label">íŠ¹ì´ì‚¬í•­ (ì„ íƒ)</label><textarea id="userNotes" class="form-input" placeholder="íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" rows="3" style="resize:vertical;"></textarea></div>
                    <div class="form-group"><label class="form-label">ì„ íƒëœ ë‚ ì§œ</label><div id="selectedDateDisplay" class="form-display">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</div></div>
                    <div class="form-group"><label class="form-label">ì„ íƒëœ ì‹œê°„</label><div id="selectedTimeDisplay" class="form-display">ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”</div></div>
                    <button id="bookingBtn" class="btn-primary" disabled>ì˜ˆì•½í•˜ê¸°</button>
                </div>
            </div>

            <div id="timeSelection" class="card hidden" style="margin-top:24px;">
                <h2 id="timeSelectionTitle" style="font-size:20px;font-weight:bold;margin-bottom:16px;color:#f3f4f6;">ì‹œê°„ ì„ íƒ</h2>
                <div id="timeSlots" class="time-slots"></div>
            </div>
        </div>

        <div id="userMode" class="hidden">
            <div class="card">
                <h2 class="card-title">ì˜ˆì•½ í˜„í™© (ì¡°íšŒë§Œ ê°€ëŠ¥)</h2>
                <div id="userBookingsList"></div>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div><div class="stat-label">ì „ì²´ ì˜ˆì•½</div><div class="stat-value" id="userStatTotal" style="color:#9ca3af;">0</div></div><div class="stat-icon" style="background:#374151;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></div></div>
                <div class="stat-card"><div><div class="stat-label">ì˜ˆì•½ëœ ë‚ ì§œ</div><div class="stat-value" id="userStatDates" style="color:#9ca3af;">0</div></div><div class="stat-icon" style="background:#374151;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg></div></div>
                <div class="stat-card"><div><div class="stat-label">ì˜ˆì•½ë¥ </div><div class="stat-value" id="userStatRate" style="color:#9ca3af;">0%</div></div><div class="stat-icon" style="background:#374151;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg></div></div>
            </div>
        </div>

        <div id="adminMode" class="hidden">
            <div class="card">
                <div style="background:#065f46;color:#d1fae5;padding:12px;border-radius:8px;margin-bottom:16px;text-align:center;font-weight:bold;">
                    ğŸ”’ ê´€ë¦¬ì ëª¨ë“œ - ëª¨ë“  ì˜ˆì•½ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    <button onclick="logout()" style="margin-left:16px;padding:6px 12px;background:#7f1d1d;color:#fca5a5;border:none;border-radius:4px;font-weight:bold;cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                <h2 class="card-title">ë‚ ì§œë³„ ì˜ˆì•½ í˜„í™© (ê´€ë¦¬ì)</h2>
                <div style="margin-bottom:12px; display:flex; justify-content:space-between; gap:8px; align-items:center;">
                    <div class="control-row">
                        <button id="exportBookingsBtn" class="btn-primary">ì˜ˆì•½ ë‚´ì—­ JSONìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                        <button id="exportLogsBtn" class="btn-primary">ë¡œê·¸ ë‚´ë³´ë‚´ê¸°</button>
                    </div>
                    <div style="font-size:13px;color:#9ca3af;">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸: <strong>admin2025</strong></div>
                </div>
                <div id="adminBookingsList"></div>
            </div>

            <div class="stats-grid">
                <div class="stat-card"><div><div class="stat-label">ì „ì²´ ì˜ˆì•½</div><div class="stat-value" id="statTotal" style="color:#9ca3af;">0</div></div><div class="stat-icon" style="background:#374151;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></div></div>
                <div class="stat-card"><div><div class="stat-label">ì˜ˆì•½ëœ ë‚ ì§œ</div><div class="stat-value" id="statDates" style="color:#9ca3af;">0</div></div><div class="stat-icon" style="background:#374151;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg></div></div>
                <div class="stat-card"><div><div class="stat-label">ì˜ˆì•½ë¥ </div><div class="stat-value" id="statRate" style="color:#9ca3af;">0%</div></div><div class="stat-icon" style="background:#374151;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg></div></div>
            </div>

            <div style="margin-top:16px;" class="card">
                <h3 style="font-size:18px;color:#f3f4f6;margin-bottom:12px;">ê´€ë¦¬ì ë¡œê·¸</h3>
                <div id="logContainer" class="log-list"></div>
            </div>
        </div>

        <div id="confirmModal" class="modal"><div class="modal-content"><div style="margin-bottom:12px;">âœ…</div><h3 class="modal-title">ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h3><p id="confirmText" class="modal-text" style="color:#9ca3af;margin-top:8px;"></p></div></div>
    </div>

    <script>
        // --- ìƒíƒœ ---
        let bookings = {}; // key: "date-time" -> { userName, password, notes, date, time, id }
        let logs = []; // { ts, action, key, detail }
        let selectedDate = null;
        let selectedTime = null;
        let viewMode = 'booking';
        let isAdminLoggedIn = false;
        const ADMIN_PASSWORD = 'admin2025';
        const timeSlots = ['10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','18:00'];

        const STORAGE_KEY_BOOKINGS = 'bf_bookings_v1';
        const STORAGE_KEY_LOGS = 'bf_logs_v1';

        // --- ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (localStorage) ---
        function saveBookingsToStorage(){
            try{
                localStorage.setItem(STORAGE_KEY_BOOKINGS, JSON.stringify(bookings));
            }catch(e){ console.error('ì €ì¥ ì‹¤íŒ¨', e); }
        }
        function loadBookingsFromStorage(){
            try{
                const raw = localStorage.getItem(STORAGE_KEY_BOOKINGS);
                bookings = raw ? JSON.parse(raw) : {};
            }catch(e){ console.error('ë¡œë”© ì‹¤íŒ¨', e); bookings = {}; }
        }
        function saveLogsToStorage(){
            try{ localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(logs)); }catch(e){ console.error(e); }
        }
        function loadLogsFromStorage(){
            try{ const raw = localStorage.getItem(STORAGE_KEY_LOGS); logs = raw ? JSON.parse(raw) : []; }catch(e){ logs = []; }
        }

        function appendLog(action, key, detail){
            const entry = { ts: new Date().toISOString(), action, key, detail };
            logs.unshift(entry); // ìµœì‹ ì´ ìœ„
            saveLogsToStorage();
            renderLogs();
        }

        // --- ìœ í‹¸ ---
        function getDayOfWeek(date){ const days=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ']; const d=new Date(2025,11,date); return days[d.getDay()]; }
        function getDayOfWeekNum(date){ const d=new Date(2025,11,date); return d.getDay(); }

        // --- ìº˜ë¦°ë” ìƒì„± ---
        function generateCalendar(){
            const firstDay = getDayOfWeekNum(1);
            const totalDays = 20;
            const calendarGrid = document.getElementById('calendarGrid'); calendarGrid.innerHTML='';
            let currentWeek=[];
            for(let i=0;i<firstDay;i++) currentWeek.push(null);
            for(let day=1; day<=totalDays; day++){
                currentWeek.push(day);
                if(currentWeek.length===7 || day===totalDays){
                    while(currentWeek.length<7) currentWeek.push(null);
                    const weekDiv = document.createElement('div'); weekDiv.className='calendar-week';
                    currentWeek.forEach((date, idx)=>{
                        const dayDiv = document.createElement('div');
                        if(date===null){ dayDiv.className='calendar-day empty'; }
                        else{
                            dayDiv.className='calendar-day'; if(date===selectedDate) dayDiv.classList.add('selected');
                            const numberDiv = document.createElement('div'); numberDiv.className='calendar-day-number'; if(idx===0) numberDiv.classList.add('sunday'); if(idx===6) numberDiv.classList.add('saturday'); numberDiv.textContent = date; dayDiv.appendChild(numberDiv);

                            const bookingCount = getBookingCount(date);
                            if(bookingCount>0){ const dotsDiv = document.createElement('div'); dotsDiv.className='booking-dots'; for(let i=0;i<Math.min(bookingCount,3); i++){ const dot=document.createElement('div'); dot.className='booking-dot'; dotsDiv.appendChild(dot);} dayDiv.appendChild(dotsDiv); }

                            dayDiv.onclick = ()=> selectDate(date);
                        }
                        weekDiv.appendChild(dayDiv);
                    });
                    calendarGrid.appendChild(weekDiv); currentWeek=[];
                }
            }
        }

        function getBookingCount(date){
            return timeSlots.filter(time=> bookings[`${date}-${time}`]).length;
        }

        // --- ì‹œê°„ ìŠ¬ë¡¯ ---
        function generateTimeSlots(){
            const container = document.getElementById('timeSlots'); const section = document.getElementById('timeSelection'); const title = document.getElementById('timeSelectionTitle');
            if(!selectedDate){ section.classList.add('hidden'); return; }
            section.classList.remove('hidden'); title.textContent = `ì‹œê°„ ì„ íƒ - 12ì›” ${selectedDate}ì¼ (${getDayOfWeek(selectedDate)})`; container.innerHTML='';
            timeSlots.forEach(time=>{
                const key = `${selectedDate}-${time}`;
                const isBooked = bookings[key];
                const slotDiv = document.createElement('div'); slotDiv.className='time-slot';
                if(isBooked) slotDiv.classList.add('booked'); else if(time===selectedTime) slotDiv.classList.add('selected');
                const timeDiv = document.createElement('div'); timeDiv.className='time-slot-time'; timeDiv.textContent=time; slotDiv.appendChild(timeDiv);
                if(isBooked){ const statusDiv=document.createElement('div'); statusDiv.className='time-slot-status'; statusDiv.textContent='ì˜ˆì•½ë¨'; slotDiv.appendChild(statusDiv); }
                else slotDiv.onclick = ()=> selectTime(time);
                container.appendChild(slotDiv);
            });
        }

        // --- ì„ íƒ/ì…ë ¥ ---
        function selectDate(date){ selectedDate = date; selectedTime = null; updateUI(); generateTimeSlots(); }
        function selectTime(time){ selectedTime = time; updateUI(); generateTimeSlots(); }

        function updateUI(){ generateCalendar();
            const dateDisplay = document.getElementById('selectedDateDisplay'); const timeDisplay = document.getElementById('selectedTimeDisplay'); const bookingBtn = document.getElementById('bookingBtn');
            if(selectedDate) dateDisplay.textContent = `12ì›” ${selectedDate}ì¼ (${getDayOfWeek(selectedDate)})`; else dateDisplay.textContent='ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”';
            if(selectedTime) timeDisplay.textContent = selectedTime; else timeDisplay.textContent='ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”';
            const userName = document.getElementById('userName').value.trim(); const userPassword = document.getElementById('userPassword').value.trim();
            bookingBtn.disabled = !(selectedDate && selectedTime && userName && userPassword.length===4);
            document.getElementById('totalBookings').textContent = `ì´ ${Object.keys(bookings).length}ê°œ ì˜ˆì•½`;
        }

        // --- ì˜ˆì•½ ìƒì„± ---
        function handleBooking(){
            const userName = document.getElementById('userName').value.trim(); const userPassword = document.getElementById('userPassword').value.trim(); const userNotes = document.getElementById('userNotes').value.trim();
            if(!selectedDate || !selectedTime || !userName || userPassword.length!==4){ alert('ëª¨ë“  ì •ë³´ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            if(!/^\d{4}$/.test(userPassword)){ alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ìë¦¬ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.'); return; }
            const key = `${selectedDate}-${selectedTime}`;
            if(bookings[key]){ alert('ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ì…ë‹ˆë‹¤.'); return; }
            // ê³ ìœ  ID ìƒì„± (ì„œë²„ ì—†ëŠ” í™˜ê²½ì—ì„œ ì¶©ëŒ ìµœì†Œí™”)
            const id = 'bk_' + Date.now().toString(36) + '_' + Math.random().toString(36).slice(2,6);
            bookings[key] = { userName, password: userPassword, notes: userNotes, date: selectedDate, time: selectedTime, id };
            saveBookingsToStorage(); appendLog('CREATE', key, { userName, date:selectedDate, time:selectedTime, id });
            // í™•ì¸ ëª¨ë‹¬
            const modal = document.getElementById('confirmModal'); const confirmText = document.getElementById('confirmText'); confirmText.textContent = `${userName} - 12ì›” ${selectedDate}ì¼ ${selectedTime}`; modal.classList.add('show');
            setTimeout(()=>{ modal.classList.remove('show'); selectedDate=null; selectedTime=null; document.getElementById('userName').value=''; document.getElementById('userPassword').value=''; document.getElementById('userNotes').value=''; updateUI(); generateTimeSlots(); renderAllViews(); }, 1500);
        }

        // --- ì·¨ì†Œ (ì‚¬ìš©ì) ---
        function cancelBooking(key){ const booking = bookings[key]; if(!booking) return; const inputPassword = prompt('ì˜ˆì•½ ì‹œ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”:'); if(!inputPassword) return; if(inputPassword !== booking.password){ alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; } if(confirm('ì´ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){ delete bookings[key]; saveBookingsToStorage(); appendLog('DELETE_USER', key, { by: 'user', id: booking.id, userName: booking.userName }); renderAllViews(); } }

        // --- ê´€ë¦¬ì ì‚­ì œ ---
        function adminCancelBooking(key){ const booking = bookings[key]; if(!booking) return; if(confirm('ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){ delete bookings[key]; saveBookingsToStorage(); appendLog('DELETE_ADMIN', key, { by: 'admin', id: booking.id, userName: booking.userName }); renderAllViews(); } }

        // --- ë·° ë Œë”ë§ ---
        function updateUserView(){ const container = document.getElementById('userBookingsList'); container.innerHTML=''; const bookingsByDate={}; for(const [key, booking] of Object.entries(bookings)){ const date = booking.date; if(!bookingsByDate[date]) bookingsByDate[date]=[]; bookingsByDate[date].push({ key, ...booking }); }
            if(Object.keys(bookingsByDate).length===0){ container.innerHTML = `<div class="empty-state" style="padding:32px;color:#6b7280;text-align:center;"><p class="empty-state-text">ì•„ì§ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`; return; }
            const sortedDates = Object.keys(bookingsByDate).sort((a,b)=>a-b);
            sortedDates.forEach(date=>{
                const section = document.createElement('div'); section.className='date-section';
                const header = document.createElement('div'); header.className='date-section-header'; header.innerHTML = `<div class="date-section-title">12ì›” ${date}ì¼ (${getDayOfWeek(date)}) - ${bookingsByDate[date].length}ê±´</div>`; section.appendChild(header);
                const body = document.createElement('div'); body.className='date-section-body';
                bookingsByDate[date].forEach(booking=>{
                    const item = document.createElement('div'); item.className='booking-item'; const hour = booking.time.split(':')[0];
                    const notesHtml = booking.notes ? `<div style="margin-top:8px;padding:8px;background:#111827;border-radius:4px;border-left:3px solid #4b5563;"><div style="font-size:12px;color:#9ca3af;margin-bottom:4px;">íŠ¹ì´ì‚¬í•­</div><div style="font-size:13px;color:#d1d5db;">${booking.notes}</div></div>` : '';
                    item.innerHTML = `
                        <div class="booking-info" style="flex-direction:column;align-items:flex-start;width:100%;">
                            <div style="display:flex;align-items:center;gap:16px;width:100%;">
                                <div class="booking-time-badge"><div class="booking-time-hour">${hour}</div><div class="booking-time-label">ì‹œ</div></div>
                                <div class="booking-details" style="flex:1;"><div class="booking-name">${booking.userName}</div><div class="booking-time-text">${booking.time}</div></div>
                                <button class="btn-cancel" onclick="cancelBooking('${booking.key}')">ì·¨ì†Œ</button>
                            </div>
                            ${notesHtml}
                        </div>`;
                    body.appendChild(item);
                });
                section.appendChild(body); container.appendChild(section);
            });
            // í†µê³„ ì—…ë°ì´íŠ¸
            const totalBookings = Object.keys(bookings).length; const uniqueDates = new Set(Object.values(bookings).map(b=>b.date)).size; const rate = Math.round((totalBookings / (20 * timeSlots.length)) * 100);
            document.getElementById('userStatTotal').textContent = totalBookings; document.getElementById('userStatDates').textContent = uniqueDates; document.getElementById('userStatRate').textContent = rate + '%';
        }

        function updateAdminView(){ const container = document.getElementById('adminBookingsList'); container.innerHTML=''; const bookingsByDate={}; for(const [key, booking] of Object.entries(bookings)){ const date=booking.date; if(!bookingsByDate[date]) bookingsByDate[date]=[]; bookingsByDate[date].push({ key, ...booking }); }
            if(Object.keys(bookingsByDate).length===0){ container.innerHTML = `<div class="empty-state" style="padding:32px;color:#6b7280;text-align:center;"><p class="empty-state-text">ì•„ì§ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`; return; }
            const sortedDates = Object.keys(bookingsByDate).sort((a,b)=>a-b);
            sortedDates.forEach(date=>{
                const section = document.createElement('div'); section.className='date-section';
                const header = document.createElement('div'); header.className='date-section-header'; header.innerHTML = `<div class="date-section-title">12ì›” ${date}ì¼ (${getDayOfWeek(date)}) - ${bookingsByDate[date].length}ê±´</div>`; section.appendChild(header);
                const body = document.createElement('div'); body.className='date-section-body';
                bookingsByDate[date].forEach(booking=>{
                    const item = document.createElement('div'); item.className='booking-item'; const hour = booking.time.split(':')[0];
                    const notesHtml = booking.notes ? `<div style="margin-top:8px;padding:8px;background:#111827;border-radius:4px;border-left:3px solid #4b5563;"><div style="font-size:12px;color:#9ca3af;margin-bottom:4px;">íŠ¹ì´ì‚¬í•­</div><div style="font-size:13px;color:#d1d5db;">${booking.notes}</div></div>` : '';
                    item.innerHTML = `
                        <div class="booking-info" style="flex-direction:column;align-items:flex-start;width:100%;">
                            <div style="display:flex;align-items:center;gap:16px;width:100%;">
                                <div class="booking-time-badge"><div class="booking-time-hour">${hour}</div><div class="booking-time-label">ì‹œ</div></div>
                                <div class="booking-details" style="flex:1;"><div class="booking-name">${booking.userName}</div><div class="booking-time-text">${booking.time}</div></div>
                                <button class="btn-cancel" onclick="adminCancelBooking('${booking.key}')">ì‚­ì œ</button>
                            </div>
                            ${notesHtml}
                        </div>`;
                    body.appendChild(item);
                });
                section.appendChild(body); container.appendChild(section);
            });
            const totalBookings = Object.keys(bookings).length; const uniqueDates = new Set(Object.values(bookings).map(b=>b.date)).size; const rate = Math.round((totalBookings / (20 * timeSlots.length)) * 100);
            document.getElementById('statTotal').textContent = totalBookings; document.getElementById('statDates').textContent = uniqueDates; document.getElementById('statRate').textContent = rate + '%';
        }

        function renderLogs(){ const container = document.getElementById('logContainer'); if(!container) return; container.innerHTML=''; if(logs.length===0){ container.innerHTML = '<div style="padding:12px;color:#6b7280;">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
            logs.forEach(entry=>{ const div = document.createElement('div'); div.className='log-item'; div.textContent = `${entry.ts} | ${entry.action} | ${entry.key} | ${JSON.stringify(entry.detail)}`; container.appendChild(div); }); }

        function renderAllViews(){ generateCalendar(); generateTimeSlots(); updateUserView(); updateAdminView(); renderLogs(); document.getElementById('totalBookings').textContent = `ì´ ${Object.keys(bookings).length}ê°œ ì˜ˆì•½`; }

        // --- ëª¨ë“œ ì „í™˜ ---
        function switchMode(mode){
            if(mode==='admin' && !isAdminLoggedIn){ const password = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:'); if(password !== ADMIN_PASSWORD){ alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; } isAdminLoggedIn = true; alert('ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
            viewMode = mode;
            const bookingModeBtn = document.getElementById('bookingModeBtn');
            const userModeBtn = document.getElementById('userModeBtn');
            const adminModeBtn = document.getElementById('adminModeBtn');
            const bookingMode = document.getElementById('bookingMode');
            const userMode = document.getElementById('userMode');
            const adminMode = document.getElementById('adminMode');

            // ë²„íŠ¼ active ì²˜ë¦¬ ë° ì„¹ì…˜ í‘œì‹œ
            bookingModeBtn.classList.remove('active'); userModeBtn.classList.remove('active'); adminModeBtn.classList.remove('active');
            bookingMode.classList.add('hidden'); userMode.classList.add('hidden'); adminMode.classList.add('hidden');
            if(mode==='booking'){ bookingModeBtn.classList.add('active'); bookingMode.classList.remove('hidden'); }
            else if(mode==='user'){ userModeBtn.classList.add('active'); userMode.classList.remove('hidden'); updateUserView(); }
            else if(mode==='admin'){ adminModeBtn.classList.add('active'); adminMode.classList.remove('hidden'); updateAdminView(); renderLogs(); }
        }

        function logout(){ if(confirm('ê´€ë¦¬ì ëª¨ë“œì—ì„œ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){ isAdminLoggedIn = false; switchMode('booking'); alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.'); } }

        // --- ë‚´ë³´ë‚´ê¸° ---
        function downloadJSON(filename, data){ const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url); }

        // --- Hash ê¸°ë°˜ ë¼ìš°íŒ… ë° ì´ë²¤íŠ¸ ì—°ê²° ---
        function applyHashRouting(){
            const hash = location.hash.replace('#','') || 'booking';
            if(hash === 'booking') switchMode('booking');
            else if(hash === 'user') switchMode('user');
            else if(hash === 'admin') switchMode('admin');
            else switchMode('booking');
        }

        window.addEventListener('hashchange', applyHashRouting);

        // ë²„íŠ¼ í´ë¦­ ì‹œ í•´ì‹œ ë³€ê²½
        document.getElementById('bookingModeBtn').addEventListener('click', ()=> { location.hash = 'booking'; });
        document.getElementById('userModeBtn').addEventListener('click', ()=> { location.hash = 'user'; });
        document.getElementById('adminModeBtn').addEventListener('click', ()=> { location.hash = 'admin'; });

        // ê¸°íƒ€ ì´ë²¤íŠ¸
        document.getElementById('bookingBtn').addEventListener('click', handleBooking);
        document.getElementById('exportBookingsBtn').addEventListener('click', ()=>{ if(!isAdminLoggedIn){ alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; } downloadJSON('bookings.json', bookings); });
        document.getElementById('exportLogsBtn').addEventListener('click', ()=>{ if(!isAdminLoggedIn){ alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; } downloadJSON('logs.json', logs); });
        document.getElementById('userName').addEventListener('input', updateUI);
        document.getElementById('userPassword').addEventListener('input', updateUI);

        // --- ì´ˆê¸°í™” ---
        loadBookingsFromStorage(); loadLogsFromStorage();
        // ì´ˆê¸° ë Œë” ë° hash ì ìš©
        renderAllViews();
        applyHashRouting();
    </script>
</body>
</html>
